<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<title>Picasa iScroll</title>
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAQAAAAAAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAANMUUAlYqEAPz//QAEH2kAwWAbAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARERERERERERDAzMzRDNDREMAAzMzMDAEQwAiIiIgAARDARERERESREMxAREREQI0QyEAERAAAkREMQAAEAASREQxEAAAARJERDERAAAREkRDMRERABESNEMxERIRERA0QwAiIiIiAARDAAMzMzMwBEMzM0QzRDA0REREREREREQAAAAAXzQAAEfoAABAAAAAQAAAAGACAABAAAAAIAAAACAAAAAgAAAAYAIAAGACAABAAAAAR/gAAHzKAAAAAAAA" />
<link rel="stylesheet" href="bootstrap.mi.css">
<style type="text/css" media="all">
body,ul,li {
	padding:0;
	margin:0;
	border:0;
color:white;
background:#000000;
	-webkit-user-select:none;
    -webkit-text-size-adjust:none;

}

#header {
	position:absolute;
	top:0; left:0;
	width:100%;
	height:45px;
	line-height:45px;
	background-image:-webkit-gradient(linear, 0 0, 0 100%, color-stop(0, #fe96c9), color-stop(0.05, #d51875), color-stop(1, #7b0a2e));
	background-image:-moz-linear-gradient(top, #fe96c9, #d51875 5%, #7b0a2e);
	background-image:-o-linear-gradient(top, #fe96c9, #d51875 5%, #7b0a2e);
	padding:0;
	color:#eee;
	font-size:20px;
	text-align:center;
}

#header a {
	color:#f3f3f3;
	text-decoration:none;
	font-weight:bold;
	text-shadow:0 -1px 0 rgba(0,0,0,0.5);
}

#wrapper {
	position:absolute; z-index:1;
	top:45px; bottom:0; left:0;
	width:100%;
	overflow:auto;

}

#scroller {
	width:800px;
	float:left;
	padding:0;
}

#scroller ul {
	z-index:2;
	list-style:none;
	display:block;
	float:left;
	width:100%;
	height:100%;
	padding:0;
	margin:0;
/*	border:1px solid #aaa;*/
}

#scroller li {
	
	display:block; float:left;
	width:133.3333px; 
	height:133.3333px; 
	background:#444444;
}

#scroller li div {
	width:120px;
	height:120px;
	margin:6px;
	
	background:#fff;
	cursor:pointer;
	box-shadow: 3px 3px 6px #888;
	/*border:1px solid #000;*/
}
#scroller li div {box-shadow: 3px 3px 6px #ddd;}


#albumy {margin-top:45px;}
.btn {margin:2px;}
.klik {cursor:pointer;}

#overlay {z-index:3; opacity:0.5; display:none; position:absolute; width:100%; height:100%; background:gray;}
#photo {z-index:4; opacity:1; display:none; position:absolute; top:0; left:0; width:100%; height:100%;}
#ramka {z-index:5; opacity:1; display:none; text-align:center;width:100%; height:100%;}
#ramka img {z-index:99; opacity:1; text-align:center; max-width:99%;cursor:pointer; border:2px solid white;}
#slajd {display:inline;z-index:10; opacity:1; text-align:center; max-width:100%;cursor:pointer;}

#modal      {display:none; z-index:15; position:fixed; top:15px; left: 4%; width:90%; padding:1%; background:#963;}
#modal_body {padding:1%; background:#444;}


.over {position:absolute; width:33.333%; top:0; height:100%; cursor:pointer; z-index:9;}
.over.left   {left:0;        }
.over.middle {left:0; margin-left:33.333%; auto;  }
.over.right  {right:0;       }
</style>



<script type="text/javascript" src="cordova-2.2.0.js"></script>
<script type="text/javascript" src="iscroll.js"></script>

<script type="text/javascript">

//document.addEventListener('DOMContentLoaded', loaded, false);
</script>



<script>
var ___moje='eede2de857491ec7';
var ___self=false;
var menuOpen=false;
var	imgmax = '800';
var obrazy=[];

	var user = window.localStorage.getItem('_picasa_user') || 'szczecinmojemiasto';
	var icon_albums	= '120c';
	var icon_photos	= '120c';


var $=function (id) {
	var prefix=id[0];
	var iid=id.slice(1,id.length);
	switch (prefix){
		case '#':	return document.getElementById(iid);   			break;
		case '.':	return document.getElementsByClassName(iid);  	break;
		default:	return document.getElementsByTagName(id); 
		}	
	}
	

function onload(){

        document.addEventListener("deviceready", onDeviceReady, false);
		try {if (device.uuid) {document.getElementById('infotest').innerHTML=device.platform+'<br />'+device.uuid;}	}
		catch(err) {onDeviceReady();}

	var ul=$('#thelist');
	ul.innerHTML='';
	picasa.show(user);	
}

    function onDeviceReady() {
		try {if (device.uuid == ___moje) ___self=true;}
		catch(er) {
			if (window.localStorage.getItem('___self___')=='ZnakZorro') ___self=true;
		}
		//document.addEventListener("resume", onResume, false);
		//document.addEventListener("pause", onPause, false);
		//document.addEventListener("online", onOnline, false);
		//document.addEventListener("offline", onOffline, false);
		//document.addEventListener("backbutton", onBackKeyDown, false);
		document.addEventListener("menubutton", onMenuKeyDown, false);		
		$('#title').innerText=user;
		var menu=$('#menu');

		if (___self){
			var arr=[
				{u:'zszczech',t:'Szczęch'},
				{u:'znakzorro',t:'ZnakZorro'},
				{u:'szczecinmojemiasto',t:'Szczecin'},
				{u:'szczecin.majowe',t:'Majowe'},
				{u:'widziensko',t:'Widzieńsko'},
				{u:'galeria111',t:'G111'},
				{u:'galeria111.111',t:'G111.111'},
				{u:'www.wizut',t:'WI'},
				//{u:'',t:''},
				//{u:'',t:''},
				];
			
			for (var o in arr){
				var bat=document.createElement("SPAN");
				bat.innerHTML='<button onClick="zapiszUser(\''+arr[o].u+'\');" class="btn btn-info">'+arr[o].t+'</button>';
				menu.appendChild(bat);
			}
		} //\if ___self

		
		// add to menu 1
		var new_user1=window.localStorage.getItem('_picasa_new_user1') || null;
		if (new_user1){
			var umenu1=document.createElement("BUTTON");
			umenu1.innerText=new_user1;
			umenu1.className='btn btn-primary';
			umenu1.addEventListener('click', zapiszUser1, false);
			menu.appendChild(umenu1);
		}
		// add to menu 2
		var new_user2=window.localStorage.getItem('_picasa_new_user2') || null;
		if (new_user2){
			var umenu2=document.createElement("BUTTON");
			umenu2.innerText=new_user2;
			umenu2.className='btn btn-primary';
			umenu2.addEventListener('click', zapiszUser2, false);
			menu.appendChild(umenu2);
		}
		// add to menu 3
		var new_user3=window.localStorage.getItem('_picasa_new_user3') || null;
		if (new_user3){
			var umenu3=document.createElement("BUTTON");
			umenu3.innerText=new_user3;
			umenu3.className='btn btn-primary';
			umenu3.addEventListener('click', zapiszUser3, false);
			menu.appendChild(umenu3);
		}
		
		
	}

	function onMenuKeyDown() {
		if (menuOpen) {$("#menu").style.display="none";menuOpen=false;}
		else          {$("#menu").style.display="block";menuOpen=true;}	
    }	
	
	
picasa = {
	show: function(user,album){

		if (album){
			//document.getElementById('albums').style.display='none';
			//var imgmax=get_with_geometry().w;
			var urlPICASA='http://picasaweb.google.com/data/feed/base/user/' + user + '/albumid/' + album + '?alt=jsonc&hl=en_US&callback=viewPhotosList&thumbsize=' + icon_photos+'&imgmax='+imgmax;
		} else {
			//document.getElementById('albums').style.display='block';
			var urlPICASA='http://picasaweb.google.com/data/feed/base/user/' + user + '?category=album&alt=jsonc&callback=viewAlbumsList&access=public&thumbsize=' + icon_albums;
		}
	//console.log(urlPICASA);	
		var script=document.createElement('SCRIPT');
		script.type='text/javascript';
		script.src=urlPICASA;
		document.getElementsByTagName('head')[0].appendChild(script);
		//rysujStrzalki();
		
	}	
}	
	
var myScroll;

function loaded() {
	if (myScroll) {myScroll.refresh(); return; }
	
	myScroll = new iScroll('wrapper', {
		snap: 'li',
		momentum: false,
		hScrollbar: false,
		vScrollbar: false
	 });
}
	

	


function viewAlbumsList(req){
if (req.error && req.error.code=='404') {$('#albumy').innerHTML='<h1>Brak takiego foto albumu</h1>'; return;}

		$('#wrapper').style.display='none';
 var ul=$('#thelist');
 var al=$('#albumy');
 al.innerHTML='';
 var ile=req.data.items.length;
		for (var i=0;i<ile;i++){
			var	html='';	
			var	htma='';	
			var self_link=req.data.items[i].selfLink;			
			var alt_link=req.data.items[i].alternateLink;
			var arr=self_link.split('/');
			var arr=arr[arr.length-1].split('?');
			var albumID=arr[0];			
			var onklik='pokazAlbum(\''+self_link+'\');';
			//html+='<a href=./?picasa='+picasa+'&album='+albumID+'>';
					//html+='<div onClick="'+onklik+'" class="ikony_galeria">';
					//html+='<img src="'+req.data.items[i].media.thumbnails[0]+'" title="'+req.data.items[i].title+'" alt="'+req.data.items[i].title+'"/>';
					//html+='</div>';

					htma+='<button onClick="'+onklik+'" class="btn btn-inverse btn-large klik">';
					htma+=req.data.items[i].title;
					htma+='</button>';
			//html+='</a>';
		al.innerHTML+=htma;
		//var li=document.createElement("LI");
		//li.innerHTML=html;
		//ul.appendChild(li);
		}
		loaded();
}	


function pokazAlbum(url_ALBUM){
	//console.log(url_ALBUM);
	//var imgmax=get_with_geometry().w;
	url_ALBUM=url_ALBUM.replace('entry','feed');
	var scriptA=document.createElement('SCRIPT');
	scriptA.type='text/javascript';
	var aplus='&callback=viewPhotosList&thumbsize='+icon_photos+'&imgmax='+imgmax;
	scriptA.src=url_ALBUM+aplus;
	document.getElementsByTagName('head')[0].appendChild(scriptA);
}

function viewPhotosList(req){
	var title=req.data.author+' / '+req.data.title +' / '+req.data.updated;
	var ile=title.length;
	var zoom=Math.min((30/ile),1);
	$('#title').innerText=title;
	$('#title').style.zoom=zoom;
//var imgmax=get_with_geometry().w;
	var ul=$('#thelist');
	var ile=req.data.items.length;
	ostatni=ile-1;
	
	//var html='<h3 title="Powrót do: '+req.data.author+'"   onClick="history.back();" style="cursor:pointer;"><a href="./?picasa='+picasa+'"> '+req.data.title+' ...</a></h3>';
	
	//obrazy=[];
	$('#albumy').style.display='none';
	$('#wrapper').style.display='block';
	for (var i=0;i<ile;i++){
	var id='im'+i;
		var onklik='pokazSlide(\''+req.data.items[i].media.image.url+'\',\''+req.data.items[i].media.image.width+'\',\''+req.data.items[i].media.image.height+'\',\''+req.data.items[i].title+'\',\''+id+'\',\''+i+'\');';					
		html='';
			html+='<div id="'+id+'" onClick="'+onklik+'" class="ikony_album">';
			html+='<img src="'+req.data.items[i].media.thumbnails[0]+'" title="'+req.data.items[i].title+'" alt="'+req.data.items[i].title+'"/>';
			html+='</div>';
				var li=document.createElement("LI");
				li.innerHTML=html;
				ul.appendChild(li);
				obrazy.push(req.data.items[i].media.image.url);
		/*
		obrazy[i]={	'title':req.data.items[i].title, 
					'obraz':req.data.items[i].media.image.url, 
					'ikona':req.data.items[i].media.thumbnails[0], 
					'width':req.data.items[i].media.image.width, 
					'height':req.data.items[i].media.image.height
				};
				
		*/
		}		
		//document.getElementById('photos').innerHTML=html;
		i=0;
		//pokazSlide(req.data.items[i].media.image.url,req.data.items[i].media.image.width,req.data.items[i].media.image.height,req.data.items[i].title,'im0',i);
	loaded();
}



function pokazSlide(url,width,height,title,id,i){

	//var img_width=get_with_geometry().w;
	//var img_height=Math.round(height/(width/img_width));
	//if (img_width<img_height) {img_width=img_width/2; img_height=img_height/2;}
	
//console.log(width+' x '+height+' --- '+img_width+' / '+img_height);
	//document.getElementById('photo').style.width =img_width+'px';
	//document.getElementById('photo').style.height=img_height+'px';
	//document.getElementById('ramka').innerHTML='<img class="photo" id="slajd" src="'+url+'" width="'+img_width+'" height="'+img_height+'" title="'+title+'" alt="'+title+'"/>';
	$('#ramka').innerHTML='<div id="slajd"><img src="'+url+'" title="'+title+'" alt="'+title+'" onClick="usun(this,\''+id+'\');" class="photo" id="'+id+'"  /></div>';
	$('#photo').style.display='block';
	$('#ramka').style.display='block';
	$('#overlay').style.display='block';
				
				var slajd=$('#slajd');
				var a=parseInt(i);
				var b=parseInt(i)-1;
				var n=parseInt(i)+1;
					var div_left=document.createElement("SPAN");
					div_left.setAttribute('id','i_'+b);
					//div_left.innerHTML='<a href="javascript:void(0);" onClick="slajdPrev();"></a>';
					div_left.className='over left';
					div_left.addEventListener('click', slajdPrev, false);
					slajd.appendChild(div_left);
					
					
					var div_middle=document.createElement("SPAN");
					div_middle.setAttribute('id','i_'+a);
					//div_middle.innerHTML='<a href="javascript:void(0);" onClick="usun(this,\''+id+'\');"></a>';
					div_middle.className='over middle';
					div_middle.addEventListener('click', slajdClose, false);
					slajd.appendChild(div_middle);
					
					var div_right=document.createElement("SPAN");
					div_right.setAttribute('id','i_'+n);
					//div_right.innerHTML='<a href="javascript:void(0);" onClick="slajdNext();"></a>';
					div_right.className='over right';
					div_right.addEventListener('click', slajdNext, false);
					slajd.appendChild(div_right);

	/*
	var j=i+1;
	if (j>ostatni) j=0;
	if (obrazy[j]) {
		document.getElementById('photo').style.backgroundImage='url('+obrazy[j].obraz+')';
		}
	document.getElementById('photo').style.backgroundSize=width+'px '+height+'px';
	aktualny=i;
	*/
}

function slajdPrev(e){
	var nr=this.id.split('_')[1];
	var url=obrazy[nr];
	var width,height,title=null;
	pokazSlide(url,width,height,title,'im'+nr,nr);

}
function slajdClose(e){
	var nr=this.id.split('_')[1];
	//console.log(nr);
	usun();
}
function slajdNext(e){
	var nr=this.id.split('_')[1];
	var url=obrazy[nr];
	var width,height,title=null;
	pokazSlide(url,width,height,title,'im'+nr,nr);
}

function usun(ten,id){
	//console.log(id);
	//console.log(ten);
	//ten.style.display='none';
	var ramka = document.getElementById('ramka');
	var slajd = document.getElementById('slajd');
	//console.log(ramka);
	//console.log(slajd);
	ramka.removeChild(slajd);
	$('#photo').style.display='none';
	$('#ramka').style.display='none';
	$('#overlay').style.display='none';
	

}

function backToAlbumsList(){
	$('#wrapper').style.display='none';
	$('#albumy').style.display='block';
	$('#thelist').innerHTML='';
}

function zapiszUser1(){var new_user1=window.localStorage.getItem('_picasa_new_user1') || null; if (new_user1) zapiszUser(new_user1);}
function zapiszUser2(){var new_user2=window.localStorage.getItem('_picasa_new_user2') || null; if (new_user2) zapiszUser(new_user2);}
function zapiszUser3(){var new_user3=window.localStorage.getItem('_picasa_new_user3') || null; if (new_user3) zapiszUser(new_user3);}

function zapiszUser(user){
	
	//var user = window.localStorage.getItem('_picasa_user') || 'szczecinmojemiasto';
	window.localStorage.setItem('_picasa_user',user);
	window.location.reload();
}

function zapiszNewUser(user){
	var new_user1=$('#new_user1').value; if (new_user1) window.localStorage.setItem('_picasa_new_user1',new_user1); else window.localStorage.removeItem('_picasa_new_user1');
	var new_user2=$('#new_user2').value; if (new_user2) window.localStorage.setItem('_picasa_new_user2',new_user2); else window.localStorage.removeItem('_picasa_new_user2');
	var new_user3=$('#new_user3').value; if (new_user3) window.localStorage.setItem('_picasa_new_user3',new_user3); else window.localStorage.removeItem('_picasa_new_user3');
	window.location.reload();
}

function dodajUser(){
	$('#menu').style.display='none';
	var new_user1=window.localStorage.getItem('_picasa_new_user1') || '';
	var new_user2=window.localStorage.getItem('_picasa_new_user2') || '';
	var new_user3=window.localStorage.getItem('_picasa_new_user3') || '';
	$('#modal').style.display='block';
	$('#modal_body').innerHTML+='<p></b>Picasa foto albumy</b></p>';
	$('#modal_body').innerHTML+='<p>1. <input id="new_user1" value="'+new_user1+'" /></p>';
	$('#modal_body').innerHTML+='<p>2. <input id="new_user2" value="'+new_user2+'" /></p>';
	$('#modal_body').innerHTML+='<p>3. <input id="new_user3" value="'+new_user3+'" /></p>';
	$('#modal_body').innerHTML+='<p><button onClick="zapiszNewUser();" class="btn btn-primary">Zapisz</button><button onClick="$(\'#modal\').style.display=\'none\';" class="btn btn-warning">Zamknij</button></p>';
}


/*
to bardzo ciekawe do sprawdzenia
var Anchors = document.getElementsByTagName("a");

for (var i = 0; i < Anchors.length ; i++) {
    Anchors[i].addEventListener("click", 
        function (event) {
            event.preventDefault();
            if (confirm('Are you sure?')) {
                window.location = this.href;
            }
        }, 
        false);
}
*/


</script>

</head>
<body onLoad="onload()">
<div id="header"><a href="javascript:void(0)" onClick="backToAlbumsList()" ><span id="title">Picasa iScroll</span></a></div>

<div id="albumy"><h1 style="text-align:center; margin-top:4em;">Foto albumu Picasa</h1></div>

<div id="wrapper">
	<div id="scroller">
		<ul id="thelist"></ul>
	</div>
</div>


<div id="menu" style="width:100%; display:none; position:fixed; left:0; bottom:0; background:#fff; padding:2px; opacity:1; z-index:10;"> 
	<button onClick="backToAlbumsList();" class="btn btn-inverse" id='albumy_menu' >Albumy</button>
	<button onClick="dodajUser();" class="btn btn-inverse">Dodaj</button>

	
</div>

<div id="overlay"></div>
<div id="photo">
<div id="ramka"></div>
</div>


<div id="modal">
<div id="modal_body"></div>
</div>
<button onClick="backToAlbumsList()" class="btn btn-inverse" style="position:absolute; left:2px;  top:5px; z-index:3;"> << </button>
<button onClick="onMenuKeyDown()" class="btn btn-inverse"    style="position:absolute; right:2px; top:5px; z-index:3;">Menu</button>
</body>
</html>